import requests
import time
from concurrent.futures import ThreadPoolExecutor, as_completed

urls = [
    "https://httpbin.org/delay/1" for _ in range(10)
]

def fetch(url):
    r = requests.get(url)
    return r.status_code

start = time.time()

with ThreadPoolExecutor(max_workers=10) as executor:

    # –ü–µ—Ä–µ–¥–∞—ë—Ç –∑–∞–¥–∞—á—É (fetch(url)) –≤ –ø—É–ª –ø–æ—Ç–æ–∫–æ–≤.
    # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç Future ‚Äî —ç—Ç–æ –∫–∞–∫ ¬´–∫–≤–∏—Ç–∞–Ω—Ü–∏—è¬ª –Ω–∞ –∑–∞–¥–∞—á—É: –ø–æ –Ω–µ–π –º–æ–∂–Ω–æ —É–∑–Ω–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–∑–∂–µ.
    # –ú—ã —Å–æ–∑–¥–∞—ë–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–¥–∞—á, –∫–æ—Ç–æ—Ä—ã–µ –ø—É–ª –¥–æ–ª–∂–µ–Ω –≤—ã–ø–æ–ª–Ω–∏—Ç—å.
    futures = [executor.submit(fetch, url) for url in urls]

    results = list()

    # as_completed(futures)
    # –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –¥–∞—ë—Ç Future –≤ –ø–æ—Ä—è–¥–∫–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞—á (–∞ –Ω–µ –≤ –ø–æ—Ä—è–¥–∫–µ –∑–∞–ø—É—Å–∫–∞).
    # –≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ, –µ—Å–ª–∏ —Ö–æ—á–µ—Ç—Å—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ –º–µ—Ä–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏.
    for future in as_completed(futures):
        # –ë–ª–æ–∫–∏—Ä—É—é—â–∏–π –≤—ã–∑–æ–≤: –∂–¥—ë—Ç, –ø–æ–∫–∞ –∑–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è, –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
        results.append(future.result())

end = time.time()

# üí° –†–∞–∑–Ω–∏—Ü–∞ —Å executor.map:
#
# map ‚Üí —Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –ø–æ—Ä—è–¥–∫–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–¥–∞—á.
#
# submit + as_completed ‚Üí –º–æ–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∑–∞–¥–∞—á–∏ –≤ –ø–æ—Ä—è–¥–∫–µ –∏—Ö –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏.
# –≠—Ç–æ –∏–Ω–æ–≥–¥–∞ –±—ã—Å—Ç—Ä–µ–µ, –µ—Å–ª–∏ –µ—Å—Ç—å –±—ã—Å—Ç—Ä—ã–µ –∏ –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –≤–ø–µ—Ä–µ–º–µ—à–∫—É.


print("–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:", results)
print("–í—Ä–µ–º—è:", round(end - start, 2), "—Å–µ–∫.")
